import { Injectable, signal, computed } from '@angular/core';

export type Language = 'de' | 'en' | 'ta';
type Translations = { [key: string]: string };

@Injectable({ providedIn: 'root' })
export class TranslationService {
  private translations: { [lang: string]: Translations } = {
    de: {
      'nav.learningPath': 'Lernpfad',
      'nav.translator': 'Übersetzer',
      'dashboard.welcome': 'Willkommen bei DeutschLern',
      'dashboard.subheading': 'Wählen Sie Ihr Niveau, um mit dem Lernen zu beginnen.',
      'dashboard.startLearning': 'Lernen beginnen',
      'level.goBack': 'Zurück',
      'level.generating': 'Ihr {{skill}} Übung wird generiert...',
      'level.aiThinking': 'KI denkt, bitte warten Sie einen Moment.',
      'level.fillBlank': 'Füllen Sie die Lücke aus:',
      'level.correct': 'Richtig!',
      'level.notQuite': 'Nicht ganz',
      'level.correctAnswerIs': 'Die richtige Antwort ist:',
      'level.nextQuestion': 'Nächste Frage',
      'level.readAloud': 'Lesen Sie den folgenden Satz laut vor:',
      'level.clickMic': 'Klicken Sie zum Sprechen auf das Mikrofon',
      'level.listening': 'Hören...',
      'level.analyzing': 'Analysiere Ihre Aussprache...',
      'level.youSaid': 'Sie sagten:',
      'level.noSpeech': '(Keine Sprache erkannt)',
      'level.wordAnalysis': 'Wortanalyse:',
      'level.tryAgain': 'Nochmal versuchen',
      'level.newSentence': 'Neuer Satz',
      'level.loadError': 'Inhalt konnte nicht geladen werden. Bitte wählen Sie eine Fähigkeit.',
      'translator.title': 'Übersetzer',
      'translator.subheading': 'Übersetzen Sie deutschen Text ins Englische oder Tamilische.',
      'translator.germanLabel': 'Deutscher Text',
      'translator.germanPlaceholder': 'Geben Sie hier deutschen Text ein...',
      'translator.targetLabel': 'Übersetzen nach',
      'translator.translateButton': 'Übersetzen',
      'translator.resultTitle': 'Übersetzungsergebnis:',
      'translator.error': 'Ein unerwarteter Fehler ist aufgetreten. Bitte versuchen Sie es erneut.',
      'footer.poweredBy': 'Unterstützt von Angular & OpenRouter AI',
      'skill.Reading': 'Lesen',
      'skill.Writing': 'Schreiben',
      'skill.Assessment': 'Bewertung',
      'skill.Speaking': 'Sprechen',
      'skill.Listening': 'Hören',
      'skill.Vocabulary': 'Wortschatz',
      'assessment.progress': 'Frage {{current}} von {{total}}',
      'assessment.complete': 'Bewertung abgeschlossen!',
      'assessment.score': 'Ihr Ergebnis: {{correct}} / {{total}} Richtig',
      'assessment.review': 'Überprüfen Sie Ihre Antworten:',
      'assessment.table.question': 'Frage',
      'assessment.table.yourAnswer': 'Ihre Antwort',
      'assessment.table.correctAnswer': 'Richtige Antwort',
      'assessment.table.status': 'Status',
      'assessment.status.correct': 'Richtig',
      'assessment.status.incorrect': 'Falsch',
      'listening.complete': 'Hörquiz abgeschlossen!',
      'listening.translationLabel': 'Übersetzung:',
      'vocabulary.title': 'Wortschatz-Trainer',
      'vocabulary.subheading': 'Erweitern Sie Ihren Wortschatz mit interaktiven Lernkarten.',
      'vocabulary.newAdjective': 'Neues Adjektiv',
      'vocabulary.newNoun': 'Neues Substantiv',
      'vocabulary.flip': 'Umdrehen',
      'vocabulary.generating': 'Generiere neue Karte...',
      'vocabulary.front': 'Vorderseite',
      'vocabulary.back': 'Rückseite',
      'vocabulary.example': 'Beispiel:',
      'vocabulary.errorUnique': 'Konnte kein einzigartiges neues Wort finden. Setze die Liste zurück und versuche es erneut.',
      'assistant.title': 'Stimmassistent',
      'assistant.welcome': 'Hallo! Wie kann ich Ihnen beim Deutschlernen helfen?',
      'assistant.micCue': 'Fragen Sie etwas über Deutsch...',
      'reports.title': 'Berichtscenter',
      'reports.empty': 'Keine Berichte verfügbar. Schließen Sie ein Hörquiz ab, um einen zu erstellen.',
      'reports.view': 'Bericht anzeigen',
      'reports.delete': 'Ausgewählte löschen',
      'reports.selectOne': 'Bitte wählen Sie einen einzelnen Bericht zum Anzeigen aus.',
    },
    en: {
      'nav.learningPath': 'Learning Path',
      'nav.translator': 'Translator',
      'dashboard.welcome': 'Welcome to DeutschLern',
      'dashboard.subheading': 'Select your level to start learning.',
      'dashboard.startLearning': 'Start Learning',
      'level.goBack': 'Go Back',
      'level.generating': 'Generating your {{skill}} exercise...',
      'level.aiThinking': 'AI is thinking, please wait a moment.',
      'level.fillBlank': 'Fill in the blank:',
      'level.correct': 'Correct!',
      'level.notQuite': 'Not quite',
      'level.correctAnswerIs': 'The correct answer is:',
      'level.nextQuestion': 'Next Question',
      'level.readAloud': 'Read the sentence below aloud:',
      'level.clickMic': 'Click the mic to start reading',
      'level.listening': 'Listening...',
      'level.analyzing': 'Analyzing your pronunciation...',
      'level.youSaid': 'You said:',
      'level.noSpeech': '(No speech detected)',
      'level.wordAnalysis': 'Word Analysis:',
      'level.tryAgain': 'Try Again',
      'level.newSentence': 'New Sentence',
      'level.loadError': 'Could not load content. Please select a skill to begin.',
      'translator.title': 'Translator',
      'translator.subheading': 'Translate German text to English or Tamil.',
      'translator.germanLabel': 'German Text',
      'translator.germanPlaceholder': 'Enter German text here...',
      'translator.targetLabel': 'Translate to',
      'translator.translateButton': 'Translate',
      'translator.resultTitle': 'Translation Result:',
      'translator.error': 'An unexpected error occurred. Please try again.',
      'footer.poweredBy': 'Powered by Angular & OpenRouter AI',
      'skill.Reading': 'Reading',
      'skill.Writing': 'Writing',
      'skill.Assessment': 'Assessment',
      'skill.Speaking': 'Speaking',
      'skill.Listening': 'Listening',
      'skill.Vocabulary': 'Vocabulary',
      'assessment.progress': 'Question {{current}} of {{total}}',
      'assessment.complete': 'Assessment Complete!',
      'assessment.score': 'Your Score: {{correct}} / {{total}} Correct',
      'assessment.review': 'Review your answers:',
      'assessment.table.question': 'Question',
      'assessment.table.yourAnswer': 'Your Answer',
      'assessment.table.correctAnswer': 'Correct Answer',
      'assessment.table.status': 'Status',
      'assessment.status.correct': 'Correct',
      'assessment.status.incorrect': 'Incorrect',
      'listening.complete': 'Listening Quiz Complete!',
      'listening.translationLabel': 'Translation:',
      'vocabulary.title': 'Vocabulary Trainer',
      'vocabulary.subheading': 'Expand your vocabulary with interactive flashcards for your level.',
      'vocabulary.newAdjective': 'New Adjective',
      'vocabulary.newNoun': 'New Noun',
      'vocabulary.flip': 'Flip',
      'vocabulary.generating': 'Generating new card...',
      'vocabulary.front': 'Front',
      'vocabulary.back': 'Back',
      'vocabulary.example': 'Example:',
      'vocabulary.errorUnique': 'Could not find a unique new word. Resetting list and trying again.',
      'assistant.title': 'Voice Assistant',
      'assistant.welcome': 'Hello! How can I help you with your German learning?',
      'assistant.micCue': 'Ask a question about German...',
      'reports.title': 'Report Center',
      'reports.empty': 'No reports available. Complete a listening quiz to generate one.',
      'reports.view': 'View Report',
      'reports.delete': 'Delete Selected',
      'reports.selectOne': 'Please select a single report to view.',
    },
    ta: {
      'nav.learningPath': 'கற்றல் பாதை',
      'nav.translator': 'மொழிபெயர்ப்பாளர்',
      'dashboard.welcome': 'DeutschLern-க்கு வரவேற்கிறோம்',
      'dashboard.subheading': 'கற்றலைத் தொடங்க உங்கள் நிலையைத் தேர்ந்தெடுக்கவும்.',
      'dashboard.startLearning': 'கற்கத் தொடங்குங்கள்',
      'level.goBack': 'பின் செல்',
      'level.generating': 'உங்கள் {{skill}} உடற்பயிற்சி உருவாக்கப்படுகிறது...',
      'level.aiThinking': 'AI சிந்தித்து வருகிறது, ദയവായി കാത്തിരിക്കുക.',
      'level.fillBlank': 'வெற்றிடத்தை நிரப்புக:',
      'level.correct': 'சரி!',
      'level.notQuite': 'சரியல்ல',
      'level.correctAnswerIs': 'சரியான பதில்:',
      'level.nextQuestion': 'அடுத்த கேள்வி',
      'level.readAloud': 'கீழே உள்ள வாக்கியத்தை உரக்கப் படியுங்கள்:',
      'level.clickMic': 'பேச മൈക്ക് ക്ലിക്ക് ചെയ്യുക',
      'level.listening': 'கேட்கிறது...',
      'level.analyzing': 'உங்கள் உச்சரிப்பை பகுப்பாய்வு செய்கிறது...',
      'level.youSaid': 'நீங்கள் சொன்னது:',
      'level.noSpeech': '(பேச்சு கண்டறியப்படவில்லை)',
      'level.wordAnalysis': 'வார்த்தை பகுப்பாய்வு:',
      'level.tryAgain': 'மீண்டும் ప్రయత్నించండి',
      'level.newSentence': 'புதிய வாக்கியம்',
      'level.loadError': 'ഉള്ളടക്കം ലോഡ് ചെയ്യാൻ കഴിഞ്ഞില്ല. ഒരു വൈദഗ്ദ്ധ്യം തിരഞ്ഞെടുക്കുക.',
      'translator.title': 'மொழிபெயர்ப்பாளர்',
      'translator.subheading': 'ஜெர்மன் உரையை ஆங்கிலம் அல்லது தமிழில் மொழிபெயர்க்கவும்.',
      'translator.germanLabel': 'ஜெர்மன் உரை',
      'translator.germanPlaceholder': 'ஜெர்மன் உரையை இங்கே உள்ளிடவும்...',
      'translator.targetLabel': 'மொழிபெயர்க்க',
      'translator.translateButton': 'மொழிபெயர்',
      'translator.resultTitle': 'மொழிபெயர்ப்பு முடிவு:',
      'translator.error': 'ഒരു അപ്രതീക്ഷിത പിശക് സംഭവിച്ചു. വീണ്ടും ശ്രമിക്കുക.',
      'footer.poweredBy': 'Angular & OpenRouter AI மூலம் இயக்கப்படுகிறது',
      'skill.Reading': 'வாசிப்பு',
      'skill.Writing': 'எழுதுதல்',
      'skill.Assessment': 'மதிப்பீடு',
      'skill.Speaking': 'பேச்சு',
      'skill.Listening': 'கேட்டல்',
      'skill.Vocabulary': 'சொற்களஞ்சியம்',
      'assessment.progress': 'கேள்வி {{current}} / {{total}}',
      'assessment.complete': 'மதிப்பீடு முடிந்தது!',
      'assessment.score': 'உங்கள் மதிப்பெண்: {{correct}} / {{total}} சரி',
      'assessment.review': 'உங்கள் பதில்களை மதிப்பாய்வு செய்யவும்:',
      'assessment.table.question': 'கேள்வி',
      'assessment.table.yourAnswer': 'உங்கள் பதில்',
      'assessment.table.correctAnswer': 'சரியான பதில்',
      'assessment.table.status': 'நிலை',
      'assessment.status.correct': 'சரி',
      'assessment.status.incorrect': 'தவறு',
      'listening.complete': 'கேட்டல் தேர்வு முடிந்தது!',
      'listening.translationLabel': 'மொழிபெயர்ப்பு:',
      'vocabulary.title': 'சொற்களஞ்சியப் பயிற்சியாளர்',
      'vocabulary.subheading': 'உங்கள் நிலைக்கான ஊடாடும் ஃபிளாшкаர்டுகள் மூலம் உங்கள் சொற்களஞ்சியத்தை விரிவாக்குங்கள்.',
      'vocabulary.newAdjective': 'புதிய பெயரடை',
      'vocabulary.newNoun': 'புதிய பெயர்ச்சொல்',
      'vocabulary.flip': 'புரட்டு',
      'vocabulary.generating': 'புதிய அட்டை உருவாக்கப்படுகிறது...',
      'vocabulary.front': 'முன்பக்கம்',
      'vocabulary.back': 'பின்பக்கம்',
      'vocabulary.example': 'உதாரணம்:',
      'vocabulary.errorUnique': 'ஒரு தனித்துவமான புதிய வார்த்தையைக் கண்டுபிடிக்க முடியவில்லை. பட்டியலை மீட்டமைத்து மீண்டும் முயற்சிக்கிறது.',
      'assistant.title': 'குரல் உதவியாளர்',
      'assistant.welcome': 'வணக்கம்! உங்கள் ஜெர்மன் கற்றலுக்கு நான் எப்படி உதவ முடியும்?',
      'assistant.micCue': 'ஜெர்மன் பற்றி ஒரு கேள்வி கேளுங்கள்...',
      'reports.title': 'அறிக்கை மையம்',
      'reports.empty': 'அறிக்கைகள் எதுவும் இல்லை. ஒன்றை உருவாக்க ஒரு கேட்டல் வினாவை முடிக்கவும்.',
      'reports.view': 'அறிக்கையைக் காண்க',
      'reports.delete': 'தேர்ந்தெடுத்ததை நீக்கு',
      'reports.selectOne': 'காண்பதற்கு ஒரு அறிக்கையைத் தேர்ந்தெடுக்கவும்.',
    },
  };

  currentLanguage = signal<Language>('de');

  private currentTranslations = computed(() => this.translations[this.currentLanguage()]);

  setLanguage(lang: Language) {
    this.currentLanguage.set(lang);
  }

  translate(key: string, interpolations?: Record<string, string | number>): string {
    let translation = this.currentTranslations()[key] || key;
    if (interpolations) {
      Object.keys(interpolations).forEach(k => {
        translation = translation.replace(`{{${k}}}`, String(interpolations[k]));
      });
    }
    return translation;
  }
}